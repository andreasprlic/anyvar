openapi: 3.0.0

info:
  title: AnyVar
  description: >-
    AnyVar aspires to provide REST-based validation, normalization,
    identification, and registration of any biological variation.

  contact:
    name: Reece Hart
    email: reecehart@gmail.com
  version: 0.0.0

tags:
  - name: General
  - name: Variation
    description: A single endpoint for all classes of primitive Variation
  - name: Variation Subtypes
    description: Endpoints for specific variation types
  - name: Variation Sets
    description: Sets of Variation primitives
  - name: Locations
    description: >-
      Where Variation occurs
  - name: Internal
    description: >-
      Internal endpoints are exposed only for testing. They will not
      be exposed in production.


paths:
  ###########################################################################
  # General

  /info:
    get:
      tags: ["General"]
      description: >-
        System status check and configuration
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Info"



  ###########################################################################
  # Variation
  
  /variation:
    put:
      tags: ["Variation"]
      summary: Create an instance of sequence variation.
      description: >-
        Creates an instance of sequence variation and returns a
        deterministically computed identifier.
        
        Requests with variant definitions that normalize to the same
        interal variant result in only one record and the same
        computed id is always returned.  That is, this endpoint is
        idempotent, irrespective of the input definition format.

        Alleles within haplotypes, and haplotypes withing genotypes,
        are subjected to canonical ordering rules. Therefore, the
        computed id of an haplotype in invariant with respect to the
        order of the defined alleles. The same invariance holds for
        genotypes and their component haplotypes.

        The following input formats are permitted:

          * Text (any descriptive text that purports to represent variation)
          * Beacon (`13 : 32936732 G > C`)
          * HGVS
          * ISCN
          * SPDI
          * gnomAD (`1-55516888-G-GA`)

      requestBody:
        content:
          application/json:
            schema:
              properties:
                definition:
                  description: >-
                    Creates a variation instance from the provided
                    `definition` parameter, which is interpreted
                    according to `format` parameter.

                    By default, the format is inferred from structure.
                    When inferred, the variation will be created as a
                    text record if other methods fail.  If format is
                    not auto and the variant cannot be parsed
                    appropriately, an error is returned.
                  type: string
                  example: "NC_000010.11:g.87894077C>T"
                normalize:
                  description: Normalize the allele in the specified direction.
                  type: string
                  enum:
                    - RIGHT
                    - LEFT
                    - SPDI
                    - NONE
                  default: RIGHT
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                  
        400:
          description: The variation could not be parsed or is otherwise invalid.
        501:
          description: >-
            The requested resource or operation is not currently
            supported. It may be supported in the future.

  /variation/{id}:
    get:
      tags: ["Variation"]
      description: gets a variation instance by id, may return any supported type of variation
      parameters:
        - name: id
          in: path
          description: variation id
          required: true
          schema:
            type: string
      responses:
        200:
          description: OK
                

  ###########################################################################
  # Variation Subtypes
  
  /allele:
    put:
      tags: ["Variation Subtypes"]
      description: >-
        An Allele is a specific, single, and contiguous Sequence at a
        Location. Each alternative Sequence may be empty, shorter,
        longer, or the same length as the interval (e.g., due to one or
        more indels).
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                definition:
                  description: >-
                    Allele definition, interpreted according to format
                  type: string
                  example: NC_000010.11:g.87894077C>T
                format:
                  description: format of definition
                  type: string
                  enum:
                    - "hgvs"
                  example: "hgvs"
              required:
                - definition
                - format
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: "http://localhost:5000/vmc.json#/definitions/Allele"
                
  /allele/{id}:
    get:
      tags: ["Variation Subtypes"]
      description: >-
        An Allele is a specific, single, and contiguous Sequence at a
        Location. Each alternative Sequence may be empty, shorter,
        longer, or the same length as the interval (e.g., due to one or
        more indels).
      parameters:
        - name: id
          in: path
          description: sequence id
          required: true
          schema:
            type: string
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: "http://localhost:5000/vmc.json#/definitions/Allele"


  ###########################################################################
  # Variation Sets
  
  /variationsets:
    get:
      description: search for a canonical allele
      tags: ["Variation Sets"]
      parameters:
        - name: hgvs
          in: query
          schema:
            type: string
          example: NC_000010.11:g.87894077C>T
      responses:
        200:
          description: found; variation returned

  /variationsets/{id}:
    get:
      description: gets a variation instance by id
      tags: ["Variation Sets"]
      parameters:
        - name: id
          in: path
          description: canonical variationset id
          required: true
          schema:
            type: string
      responses:
        200:
          description: found; variation returned


  ###########################################################################
  # Locations
  
  /locations/{id}:
    get:
      tags: ["Locations"]
      description: >-
        An identifiable position or region on a Sequence, defined by
        Sequence Id and an Interval.
      parameters:
        - name: id
          in: path
          description: sequence id
          required: true
          schema:
            type: string
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: "http://localhost:5000/vmc.json#/definitions/Location"


  # ######################################################################
  # INTERNAL ENDPOINTS FOR TESTING

  /positions:
    get:
      tags: ["Internal"]
      description: Return positions
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "http://localhost:5000/vmc.json#/definitions/Position"
  
    put:
      tags: ["Internal"]
      description: create a position instance
      requestBody:
        content:
          application/json:
            schema:
              $ref: 'http://localhost:5000/vmc.json#/definitions/Position'
            examples:
              Simple:
                value:
                  type: Interval
                  start: 22
                  end: 33
              BaseOffset:
                value:
                  type: Interval
                  start: 50
                  start_offset: -6
                  end: 60
                  end_offset: 7
              RangedInterval:
                value:
                  type: RangedInterval
                  start:
                    start: 100
                    end: 110
                  end:
                    start: 200
                    end: 210

      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: "http://localhost:5000/vmc.json#/definitions/Position"

  /positions/{id}:
    get:
      description: >-
        Return a single position
      tags: ["Internal"]
      parameters:
        - name: id
          in: path
          description: position id
          required: true
          schema:
            type: string
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: "http://localhost:5000/vmc.json#/definitions/Position"


# ######################################################################
# COMPONENTS

components:
  schemas:
    Info:
      type: object
      example:
        version: "0.0.0"
        dependencies:
          biocommons.seqrepo:
            instance_directory: /usr/local/share/seqrepo/latest
            version: "0.4.2"
          hgvs:
            version: "1.2.4"
          bioutils:
            version: "0.4.2"

    # External references -- necessary for definitions to show up in
    # generated docs
    ### TODO: Does following inclusion of section include all defs?
    ### $ref: "http://localhost:5000/vmc.json#/definitions/"
    Allele:
      $ref: "http://localhost:5000/vmc.json#/definitions/Allele"
